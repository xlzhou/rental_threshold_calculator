<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Help - Rental Threshold Calculator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .help-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .help-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .help-section h2 {
            color: #2c3e50;
            margin-top: 0;
        }
        .help-section h3 {
            color: #34495e;
            margin-top: 20px;
        }
        .parameter-list {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .parameter-list dt {
            font-weight: bold;
            color: #2c3e50;
            margin-top: 10px;
        }
        .parameter-list dd {
            margin-left: 20px;
            margin-bottom: 8px;
        }
        .example-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        .back-link {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #3498db;
            color: white;
            padding: 10px 15px;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
        }
        .back-link:hover {
            background: #2980b9;
        }
    </style>
</head>
<body>
    <a href="javascript:window.close()" class="back-link">← Close Help</a>
    
    <div class="help-container">
        <header>
            <h1>Rental Threshold Calculator - Help Guide</h1>
            <p>Learn how to use the calculator to optimize your rental inventory decisions</p>
        </header>

        <div class="help-section">
            <h2>🎯 What is the Rental Threshold Calculator?</h2>
            <p>This tool helps you determine the optimal pricing threshold for accepting rental requests. It uses dynamic programming to find the best policy that maximizes your revenue while managing inventory risk.</p>
            <p>这个工具可以帮助你确定接受租赁请求的最佳价格阈值。它使用动态规划来寻找最优策略，在最大化收益的同时，控制库存风险。</p>

            <h3>Key Concepts:</h3>
            <ul>
                <li><strong>Static Threshold:</strong> A fixed price below which you reject all offers<br>
                    静态阈值（Static Threshold）：一个固定的价格，低于该价格的所有报价都被拒绝。</li>
                <li><strong>Dynamic Threshold:</strong> A time and inventory-dependent threshold that adapts to current conditions<br>
                    动态阈值（Dynamic Threshold）：一个随时间和库存变化而调整的阈值，能够根据当前状况自适应。</li>
                <li><strong>Policy:</strong> The decision rule that tells you whether to accept or reject an offer<br>
                    决策策略（Policy）：一条决策规则，用来判断是否接受或拒绝某个报价。</li>
            </ul>
        </div>

        <div class="help-section">
            <h2>📊 Input Parameters</h2>
            <div class="parameter-list">
                <dl>
                    <dt>Starting Inventory (X)</dt>
                    <dd>The number of units (servers) you have available at the beginning</dd>
                    <dd>起始的库存数量，这里指的是待租赁的服务器台数</dd>

                    <dt>Horizon Length (days)</dt>
                    <dd>Total days in the planning horizon (e.g., 30 days)</dd>
                    <dd>销售周期内总天数，例如：月度规划时通常取 30 天；年度规划可取 365 天</dd>

                    <dt>Unit Cost (c)</dt>
                    <dd>The cost per unit in thousands. This is your break-even point</dd>
                    <dd>单位成本</dd>
                    
                    <dt>Salvage Value (s)</dt>
                    <dd>The value you can recover from unsold inventory at the end (default: 0)</dd>
                    <dd>残值，在租赁业务中，残值一般为0，就是没租出去没有任何收益</dd>

                    <dt>Arrival Rate</dt>
                    <dd>Average number of customers arriving per period (e.g., 0.8 means 0.8 customers per day on average)</dd>
                    <dd>平均客户到达率（每个周期），比如周期为月，则0.8代表每天平均收到0.8个报价，本月内总共有30*0.8=24个报价</dd>
                    <dt>Target Leftover (L*)</dt>
                    <dd>Desired number of units to keep in reserve (default: 3)</dd>
                    <dd>Target Leftover (L*) – 目标剩余库存
                        定义：在整个销售/租赁周期结束时，你允许最多剩下的库存数量。
                        在你的设定里，L* = 3。
                        含义：这是一个“软目标”，即便最后真的剩 3 个没租掉，也算是可以接受的，不算失败。
                        作用：计算接受阈值时，公式会尽量保证在预期上把库存卖到只剩 ≤ L*。
                        比如你有 19 个库存，目标 L* = 3，就意味着必须至少卖掉 16 个。
                        于是系统会根据报价分布和剩余天数，选择一个阈值（最低接受价），使得预期销量 ≥16。</dd>

                    <dt>Failure Threshold</dt>
                    <dd>Maximum leftover inventory before it's considered a failure (default: 5)</dd>
                    
                    <dd>Failure Threshold – 失败门槛
                        定义：如果期末剩余库存超过这个数值，则被视为彻底失败。
                        在你的设定里，Failure Threshold = 5。
                        含义：这是一个“硬约束”。如果最后剩余量 > 5，就算中途赚了一点钱，也被视为任务失败。
                        作用：
                        在计算接受阈值时，哪怕牺牲利润（接受低于成本的 sub-c 报价），也要避免超过这个门槛。
                        程序里会做 Safety Check：如果用当前阈值预计剩余 > 5，就自动降低阈值（接受更多低价），以确保安全。</dd>
                </dl>
            </div>
        </div>

        <div class="help-section">
            <h2>💰 Price Input Methods</h2>
            
            <h3>1. Manual Entry</h3>
            <p>Enter historical prices separated by commas. Example: <code>65,64,60,59,55</code></p>
            <p>输入历史价格，用逗号分隔</p>
            
            <h3>2. CSV File Upload</h3>
            <p>Upload a CSV file with prices. The file should have one column with numerical values:</p>
            <div class="example-box">
                <strong>Example CSV format:</strong><br>
                65<br>
                64<br>
                60<br>
                59<br>
                55
            </div>
        </div>

        <div class="help-section">
            <h2>🔍 Current State Analysis</h2>
            <p>Use this section to check what the optimal decision is for your current situation:</p>
            
            <div class="parameter-list">
                <dl>
                    <dt>Offer Price</dt>
                    <dd>The price a customer is currently offering</dd>
                    <dd>客户出价</dd>
                    
                    <dt>Current Period</dt>
                    <dd>Which time period you're currently in (0 to T-1)</dd>
                    <dd>当前是周期的第几天</dd>
                    
                    
                    <dt>Current Inventory</dt>
                    <dd>How many units you currently have available</dd>
                    <dd>当前可用库存</dd>
                </dl>
            </div>
        </div>

        <div class="help-section">
            <h2>📈 Understanding Results</h2>
            
            <h3>Threshold Display</h3>
            <ul>
                <li><strong>$X.XX K:</strong> Accept offers above this price</li>
                <li><strong>$0.00 K:</strong> Accept any offer (usually when inventory is high and time is running out)</li>
                <li><strong>No offers accepted:</strong> Reject all offers (usually at end of period or no inventory)</li>
            </ul>
            
            <h3>When Threshold is $0.00</h3>
            <p>This happens when:</p>
            <ul>
                <li>You have too much inventory relative to remaining time</li>
                <li>The algorithm prioritizes selling over holding inventory</li>
                <li>Salvage value is low or zero</li>
            </ul>
        </div>

        <div class="help-section">
            <h2>🚚 Arrival Model (DP)</h2>
            <p><strong>English:</strong> The dynamic programming model treats arrivals as a per-period Bernoulli event with probability p_arrival = 1 − exp(−λ). The rate λ comes from the "Arrival Rate" field; if total arrivals N over T periods are known, λ = N/T. Each period combines a no-arrival branch and an arrival branch in the Bellman update:</p>
            <div class="example-box">
                V_t(x) = (1 − p_arrival) · V_{t+1}(x) + p_arrival · E_p[ max{ p − c + V_{t+1}(x−1), V_{t+1}(x) } ]
            </div>
            <ul>
                <li>One price draw is considered only when an arrival occurs.</li>
                <li>If no arrival, inventory carries forward unchanged.</li>
                <li>Static analysis uses expected total arrivals N directly; DP uses per-period arrival probability. For large arrival rates, p_arrival ≈ 1 (≈ one offer per period).</li>
            </ul>
            <p><strong>中文：</strong> 动态规划将“客户到达”建模为每个周期一次的伯努利事件，概率为 p_arrival = 1 − exp(−λ)。λ 来自“到达率”输入；若给出总到达 N 与周期数 T，则 λ = N/T。贝尔曼方程将“无到达”和“有到达”两种情况加权：</p>
            <div class="example-box">
                V_t(x) = (1 − p_arrival) · V_{t+1}(x) + p_arrival · E_p[ max{ p − c + V_{t+1}(x−1), V_{t+1}(x) } ]
            </div>
            <ul>
                <li>只有在“有到达”时才进行一次价格抽样与接受/拒绝决策。</li>
                <li>若“无到达”，库存直接结转到下一周期。</li>
                <li>静态分析直接使用总到达 N；DP 使用每周期到达概率。到达率较大时，p_arrival ≈ 1（近似每周期都有一次报价）。</li>
            </ul>
        </div>

        <div class="help-section">
            <h2>🧮 Variable Duration (SOBP)</h2>
            <p><strong>English:</strong> For a rental with duration D periods, we use a Sum of Bid Prices (SOBP) heuristic to account for multi-period occupancy. The per-period threshold is:</p>
            <div class="example-box">
                per-threshold = max(cost_floor, c + (Σ b_{t+i}(x))/D)
            </div>
            <p>The total-price threshold is:</p>
            <div class="example-box">
                total-threshold = max(D·cost_floor, D·c + Σ b_{t+i}(x))
            </div>
            <ul>
                <li>If D extends beyond the horizon, a terminal shadow bid is applied for the extra periods.</li>
                <li>Offer type can be per-period or total. The UI shows both thresholds.</li>
            </ul>
            <p><strong>中文：</strong> 对于租期 D 个周期的报价，使用“位移成本求和（SOBP）”近似计算阈值，显式计入多期占用的机会成本：</p>
            <div class="example-box">
                每期阈值 = max(cost_floor, c + (Σ b_{t+i}(x))/D)<br>
                整单阈值 = max(D·cost_floor, D·c + Σ b_{t+i}(x))
            </div>
            <ul>
                <li>若 D 超出当前视窗，用“终端影子价”近似超出部分的边际价值。</li>
                <li>支持“按期价格/整单总价”两种口径，并在界面中展示两种阈值。</li>
            </ul>
        </div>

        <div class="help-section">
            <h2>⏱️ Time Granularity Tips</h2>
            <p><strong>English:</strong> If expected total offers N in a month greatly exceeds T, either refine the time step (increase T so per-period arrival probability p ≈ 1) or consider a future upgrade to allow multiple arrivals per period.</p>
            <p><strong>中文：</strong> 如果月内总报价 N 远大于 T，建议细化时间粒度（增大 T，使每期 p≈1），或后续启用“期内多到达”的扩展模型。</p>
        </div>

        <div class="help-section">
            <h2>💡 Example Scenario</h2>
            <div class="example-box">
                <strong>Server Rental Business:</strong><br><br>
                • Starting Inventory: 10 servers<br>
                • Horizon Length: 30 days<br>
                • Unit Cost: $60K per server<br>
                • Arrival Rate: 0.8 customers/day<br>
                • Historical Prices: $65K, $64K, $60K, $59K, $55K<br><br>
                
                <strong>Interpretation:</strong><br>
                With 0.8 customers per day and 10 servers over 30 days, you expect ~24 customers. The calculator will find the optimal threshold to maximize profit while managing the risk of unsold inventory.
            </div>
        </div>

        <div class="help-section">
            <h2>⚠️ Common Issues</h2>
            
            <h3>Threshold Shows $0.00</h3>
            <p><strong>Cause:</strong> Too much inventory, too little time remaining<br>
            <strong>Solution:</strong> Increase arrival rate, reduce starting inventory, or extend time horizon</p>
            
            <h3>No Offers Accepted</h3>
            <p><strong>Cause:</strong> End of time horizon or no inventory remaining<br>
            <strong>Solution:</strong> Check current period and inventory values</p>
            
            <h3>Very High Thresholds</h3>
            <p><strong>Cause:</strong> Low arrival rate or high costs<br>
            <strong>Solution:</strong> Review arrival rate and cost parameters</p>
        </div>

        <div class="help-section">
            <h2>🚀 Tips for Best Results</h2>
            <ul>
                <li>Use realistic historical price data for better accuracy</li>
                <li>Regularly update your current period and inventory</li>
                <li>Consider seasonal variations in arrival rates</li>
                <li>Monitor the difference between static and dynamic thresholds</li>
                <li>Adjust target leftover based on demand uncertainty</li>
            </ul>
        </div>
    </div>
</body>
</html>
